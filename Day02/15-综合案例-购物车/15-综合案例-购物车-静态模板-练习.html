<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="./styles/index.css"> -->
    <link ref="stylesheet" href="./css/inputnumber.css">
    <link ref="stylesheer" href="./css/index.css">
    <title>Document</title>
</head>
<body>
    <div id="app" class="app-container">
        <!-- é¡¶éƒ¨banner -->
        <div class="banner-box"><img src="./imgs/10-01.png" alt=""></div>
        <!-- é¢åŒ…å±‘ -->
        <div class="breadcrumb">
            <span>ğŸ </span>
            /
            <span>è´­ç‰©è½¦</span>
        </div>
        <!-- è´­ç‰©è½¦ä¸»ä½“ -->
        <div class="main" v-if="fruitList.length > 0">
            <div class="table">
                <!-- å¤´éƒ¨ -->
                <div class="thead">
                    <div class="tr">
                        <div class="th">é€‰ä¸­</div>
                        <div class="th th-pic">å›¾ç‰‡</div>
                        <div class="th">å•ä»·</div>
                        <div class="th num-th">ä¸ªæ•°</div>
                        <div class="th">å°è®¡</div>
                        <div class="th">æ“ä½œ</div>
                    </div>
                </div>
                <!-- èº«ä½“ -->
                <div class="tbody">
                    <div v-for="(item, index) in fruitList" :key="item.id" class="tr" :class="{active:item.isChecked}">
                        <div class="td"><input type="checkbox" v-model="item.isChecked"></div>
                        <div class="td"><img :src="item.icon" alt=""></div>
                        <div class="td">{{item.price}}</div>
                        <div class="td">
                            <div class="my-input-number">
                                <button class="decrease" :disabled="item.num < 2" @click="item.num--"> - </button>
                                <span class="my-input__inner">{{item.num}}</span>
                                <button class="increase" @click="item.num++"> + </button>
                            </div>
                        </div>
                        <div class="td">{{item.num * item.price}}</div>
                        <div class="td" @click="del(item.id)"><button>åˆ é™¤</button></div>
                    </div>
                </div>
            </div>
            <!-- åº•éƒ¨ -->
            <div class="bottom">
                <!-- å…¨é€‰ -->
                <label class="check-all">
                    <input type="checkbox" v-model="isAll">
                    å…¨é€‰
                </label>
                <div class="right-box">
                    <!-- æ‰€æœ‰å•†å“æ€»ä»· -->
                    <span class="price-box">æ€»ä»·&nbsp;&nbsp;:&nbsp;&nbsp;ï¿¥&nbsp;<span>{{totalPrice}}</span></span>
                    <!-- ç»“ç®—æŒ‰é’® -->
                    <button class="pay">ç»“ç®—ï¼ˆ {{totalCount}} ï¼‰</button>
                </div>
            </div>
        </div>
        <!-- ç©ºè½¦ -->
        <div class="empty" v-else>ğŸššç©ºç©ºå¦‚ä¹Ÿ</div>
    </div>
    <script src="../../vue.js"></script>
    <script>
        /**
         * ç›®æ ‡1ï¼šæ¸²æŸ“åŠŸèƒ½
         * 1.1 ä½¿ç”¨ v-if å®ç°ä¸»ä½“çš„äº’æ–¥æ˜¾ç¤º
         * 1.2 ä½¿ç”¨ v-for æ¸²æŸ“ä¸»ä½“å†…å®¹
         * 1.3 ä½¿ç”¨ v-model åŒå‘ç»‘å®šå¤é€‰æ¡†çš„çŠ¶æ€
         * 
         * ç›®æ ‡2ï¼šåˆ é™¤åŠŸèƒ½
         * 2.1 ç»™åˆ é™¤æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œä¼ å…¥ id
         * 2.2 æ ¹æ® id åˆ é™¤æ•°æ®
         * 
         * ç›®æ ‡3ï¼šä¿®æ”¹ä¸ªæ•°
         * 3.1 ç»™ + å’Œ - æŒ‰é’®ç»‘å®š ç‚¹å‡»äº‹ä»¶ï¼Œè®© item.num++ / item.num--
         * 3.2 å¯¹ - æŒ‰é’®è¿›è¡Œè¶Šç•Œå¤„ç†ï¼Œæ•°é‡å°äº 2 çš„æ—¶å€™ï¼Œä¸å…è®¸ å†ç‚¹å‡»äº†
         * 
         * ç›®æ ‡4ï¼šå…¨é€‰åé€‰
         * 4.1 è®¡ç®—å±æ€§ computed 
         * 
         * ç›®æ ‡5ï¼šç»Ÿè®¡æ€»ä»·å’Œæ€»æ•°é‡
         * 5.1 ç»Ÿè®¡é€‰ä¸­çš„æ€»ä»·å’Œæ€»æ•°é‡ï¼šè®¡ç®—å±æ€§ computed reduce æ¡ä»¶æ±‚å’Œ
         * 
         * ç›®æ ‡6ï¼šæ•°æ®æŒä¹…åŒ–åˆ°æœ¬åœ°
         * 6.1 watchç›‘è§†ï¼ŒlocalStorageï¼ŒJSON.stringifyï¼ŒJSON.parse
        */
        const app = new Vue({
            el:'#app',
            data:{
                fruitList : JSON.parse(localStorage.getItem("fruitList")) || 0
                // fruitList:[
                //     {
                //         id:1,
                //         icon:'./imgs/10-01.png',
                //         isChecked: true,
                //         num: 2,
                //         price:6,
                //     },
                //     {
                //         id:2,
                //         icon:'./imgs/10-02.png',
                //         isChecked: false,
                //         num: 7,
                //         price:6,
                //     },
                //     {
                //         id:3,
                //         icon:'./imgs/10-03.png',
                //         isChecked: false,
                //         num: 3,
                //         price:40,
                //     },
                //     {
                //         id:4,
                //         icon:'./imgs/10-04.png',
                //         isChecked: true,
                //         num: 10,
                //         price:3,
                //     },
                //     {
                //         id:5,
                //         icon:'./imgs/10-05.png',
                //         isChecked: false,
                //         num: 20,
                //         price:34,
                //     },
                // ]
            },
            methods:{
                del(id){
                    this.fruitList = this.fruitList.filter(item => item.id !== id)
                }
            },
            computed:{
                isAll:{
                    get(){
                        // ç»Ÿè®¡ æ‰€æœ‰å°é€‰æ¡† çš„çŠ¶æ€ï¼Œéƒ½æ˜¯ true åˆ™è¿”å›trueï¼Œåªè¦æœ‰ä¸€ä¸ªæ˜¯ false åˆ™è¿”å› false
                        return this.fruitList.every(item => item.isChecked)
                    },
                    set(val){
                        console.log(val)
                        this.fruitList.forEach(element => {
                            element.isChecked = val
                        });
                    }
                },
                totalPrice() {
                    return this.fruitList.reduce((sum, item)=>{
                        if(item.isChecked)
                            return sum + item.num * item.price
                        else
                            return sum
                    }, 0)
                },
                totalCount(){
                    return this.fruitList.reduce((sum, item)=>{
                        if(item.isChecked)
                            return sum + item.num
                        else
                            return sum
                    }, 0)
                }
            },
            watch:{
                fruitList:{
                    deep: true,
                    handler(){
                        // localStorage å†…å­˜æ”¾çš„æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€æœ‰è¦å°† å¯¹è±¡è½¬åŒ–ä¸º å­—ç¬¦ä¸²è¿›è¡Œå­˜å‚¨
                        localStorage.setItem('fruitList',JSON.stringify(this.fruitList))
                    }
                }
            }
        })
    </script>
</body>
</html>